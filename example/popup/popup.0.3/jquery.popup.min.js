!function(t){t.popup=function(i){var o=t.extend({popup:null,url:null,html:null,mask:"js-mask",maskclass:null,position:"fixed",noscroll:!1,zindex:9999,opacity:.5,width:null,height:null,timer:null,output:null,esc:!0,jump:null,fn:null,callback:null},i);if(!o.popup)throw new Error('"popup"参数未定义');var e,s=t("#"+o.popup),n={closeActive:function(){t("body").find('[popup-status="show"]').attr("popup-status","hide").find(".close").click()},mask:function(){var i=t("#"+o.mask);if(i.length>0){if(i.is(":visible"))return!0;i.css({zIndex:o.zindex}).stop(!0,!0).fadeIn(200)}else{var e=t('<div id="'+o.mask+'">');e.attr("class",o.maskclass?o.maskclass:"js-mask"),t("body").append(e),e.hide().css({position:"fixed",top:0,left:0,zIndex:o.zindex?o.zindex:1e3,width:"100%",height:"100%",backgroundColor:"#000",opacity:o.opacity}).stop(!0,!0).fadeIn(200)}return!1},noscroll:function(){var i=t("html"),o=i.attr("style");return i.css({overflow:"hidden"}),o},setCss:function(i){var o,e=t.extend({popup:null,mask:null,width:null,height:null,zindex:null},i);e.width&&e.popup.css("width",e.width+"px"),e.height&&e.popup.css("height",e.height+"px"),e.zindex?e.popup.css({zIndex:Number(e.zindex)+10}):(o=e.mask.css("z-index"),e.popup.css({zIndex:Number(o)+10}))},timer:function(i,s){if("number"!=typeof i||1>=i)throw new Error("参数类型错误或小于等于1");var p=Math.ceil(i-1),l=t("#"+o.popup);l.find(s).text(p+"秒"),window.clearTimeout(e),e=window.setTimeout(function(){return p>1?(l.find(s).text(p+"秒"),n.timer(p,s)):void t("#"+o.popup+" .close").click()},1e3)},close:function(i,s){var n=t("#"+o.mask);n.length&&n.hide(),window.clearTimeout(e),o.noscroll===!0&&(void 0==s?t("html").removeAttr("style"):t("html").attr("style",s)),o.jump&&(document.location=o.jump);var p=i.parents("#"+o.popup),l=p.attr("popup-mark");p.attr("popup-status","hide"),"own"==l?p.hide():p.remove(),o.callback&&o.callback()},esc:function(i){t("body").delegate(i,"keyup",function(t){27==t.keyCode&&i.find(".close").click()})},position:function(i,o){var i=t("#"+i),e=t(window),s=e.width(),n=e.height(),p=i.width(),l=i.height(),u=e.scrollTop(),c=e.scrollLeft();if(l>n){var a=u,r=(s-p)/2+c;i.css({position:"absolute",top:a,left:r,margin:0})}else if("fixed"==o){var a=(n-l)/2,r=(s-p)/2;i.css({position:"fixed",top:a,left:r,margin:0})}else if("absolute"==o){var a=(n-l)/2+u,r=(s-p)/2+c;i.css({position:"absolute",top:a,left:r,margin:0})}}};if(s.length>0){var p,l;if(s.is(":visible"))return;n.closeActive(),o.mask&&n.mask(),l=t("#"+o.mask),s.hide().stop(!0,!0).fadeIn(200,function(){s.attr({"popup-status":"show","popup-mark":"own"})}),o.noscroll===!0&&(p=n.noscroll()),n.setCss({popup:s,mask:l,width:o.width,height:o.height,zindex:o.zindex}),s.find(".close").bind("click",function(){n.close(t(this),p)}),n.position(o.popup,o.position),o.fn&&o.fn(n),o.timer&&n.timer(o.timer,o.output),o.esc===!0&&n.esc(s)}else if(o.html){var p,l,s=t("#"+o.popup);if(s.length)return;n.closeActive(),o.mask&&(maskstatus=n.mask()),l=t("#"+o.mask),t("body").append(o.html),o.noscroll===!0&&(p=n.noscroll()),s=t("#"+o.popup),s.hide().stop(!0,!0).fadeIn(200,function(){s.attr("popup-status","show")}),n.setCss({popup:s,mask:l,width:o.width,height:o.height,zindex:o.zindex}),s.find(".close").bind("click",function(){n.close(t(this),p)}),n.position(o.popup,o.position),o.fn&&o.fn(n),o.timer&&n.timer(o.timer,o.output),o.esc===!0&&n.esc(s)}else{if(!o.url)return!1;t.ajax({type:"GET",url:o.url,dataType:"html",success:function(i){var e,s,p=t("#"+o.popup);p.length||(n.closeActive(),o.mask&&(maskstatus=n.mask()),s=t("#"+o.mask),t("body").append(i),o.noscroll===!0&&(e=n.noscroll()),p=t("#"+o.popup),p.hide().stop(!0,!0).fadeIn(200,function(){p.attr("popup-status","show")}),n.setCss({popup:p,mask:s,width:o.width,height:o.height,zindex:o.zindex}),p.find(".close").bind("click",function(){n.close(t(this),e)}),n.position(o.popup,o.position),o.fn&&o.fn(n),o.timer&&n.timer(o.timer,o.output),o.esc===!0&&n.esc(p))}})}t(window).resize(function(){n.position(o.popup,o.position)})}}(jQuery);