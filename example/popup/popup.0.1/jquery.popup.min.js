!function(t){t.fn.popup=function(e){var i=t.extend({popup:null,url:null,html:null,mask:"js-mask",maskclass:null,position:"fixed",noscroll:!1,zindex:1e3,opacity:.5,width:null,height:null,timer:null,output:null,esc:!0,jump:null,fn:null,callback:null},e);if(!i.popup)throw new Error('"popup"参数未定义');var s,o=t("#"+i.popup),n=t("#"+i.mask),p={closeActive:function(){t("body").find('[popup-status="show"]').attr("popup-status","hide").find(".close").click()},mask:function(){var e=t("#"+i.mask);if(e.length>0){if(e.is(":visible"))return!0;e.css({zIndex:i.zindex}).stop(!0,!0).fadeIn(300)}else{var s=t('<div id="'+i.mask+'">');s.attr("class",i.maskclass?i.maskclass:"js-mask"),t("body").append(s),s.hide().css({position:"fixed",top:0,left:0,zIndex:i.zindex?i.zindex:1e3,width:"100%",height:"100%",backgroundColor:"#000",opacity:i.opacity}).stop(!0,!0).fadeIn(300)}return!1},noscroll:function(){var e=t("html"),i=e.attr("style");return e.css({overflow:"hidden"}),i},timer:function(e,o){if("number"!=typeof e||1>=e)throw new Error("参数类型错误或小于等于1");var n=Math.ceil(e-1),l=t("#"+i.popup);l.find(o).text(n+"秒"),window.clearTimeout(s),s=window.setTimeout(function(){return n>1?(l.find(o).text(n+"秒"),p.timer(n,o)):void t("#"+i.popup+" .close").click()},1e3)},close:function(e,o){var n=t("#"+i.mask);n.length&&n.hide(),window.clearTimeout(s),i.noscroll===!0&&(void 0==o?t("html").removeAttr("style"):t("html").attr("style",o)),null!==i.jump&&(document.location=i.jump);var p=e.parents("#"+i.popup),l=p.attr("popup-mark");p.attr("popup-status","hide"),"own"==l?p.hide():p.remove(),null!==i.callback&&i.callback()},esc:function(e){t("body").delegate(e,"keyup",function(t){27==t.keyCode&&e.find(".close").click()})},position:function(e,i){var e=t("#"+e),s=t(window),o=s.width(),n=s.height(),p=e.width(),l=e.height(),c=s.scrollTop(),u=s.scrollLeft();if(l>n){var r=c,a=(o-p)/2+u;e.css({position:"absolute",top:r,left:a,margin:0})}else if("fixed"==i){var r=(n-l)/2,a=(o-p)/2;e.css({position:"fixed",top:r,left:a,margin:0})}else if("absolute"==i){var r=(n-l)/2+c,a=(o-p)/2+u;e.css({position:"absolute",top:r,left:a,margin:0})}}};if(o.length>0){var l,n,c;if(o.is(":visible"))return;p.closeActive(),i.mask&&p.mask(),n=t("#"+i.mask),o.hide().attr({"popup-status":"show","popup-mark":"own"}).stop(!0,!0).fadeIn(300),i.noscroll===!0&&(l=p.noscroll()),i.width&&o.css("width",i.width+"px"),i.height&&o.css("height",i.height+"px"),i.zindex?o.css({zIndex:Number(i.zindex)+10}):(c=n.css("z-index"),o.css({zIndex:Number(c)+10})),o.find(".close").bind("click",function(){p.close(t(this),l)}),p.position(i.popup,i.position),i.fn&&i.fn(p),i.timer&&p.timer(i.timer,i.output),i.esc===!0&&p.esc(o)}else if(i.html){var l,n,c,o=t("#"+i.popup);if(o.length)return;p.closeActive(),i.mask&&(maskstatus=p.mask()),n=t("#"+i.mask),t("body").append(i.html),i.noscroll===!0&&(l=p.noscroll()),o=t("#"+i.popup),o.hide().attr("popup-status","show").stop(!0,!0).fadeIn(300),i.width&&o.css("width",i.width+"px"),i.height&&o.css("height",i.height+"px"),i.zindex?o.css({zIndex:Number(i.zindex)+10}):(c=n.css("z-index"),o.css({zIndex:Number(c)+10})),o.find(".close").bind("click",function(){p.close(t(this),l)}),p.position(i.popup,i.position),i.fn&&i.fn(p),i.timer&&p.timer(i.timer,i.output),i.esc===!0&&p.esc(o)}else{if(!i.url)return!1;t.ajax({type:"GET",url:i.url,dataType:"html",success:function(e){var s,o,n,l=t("#"+i.popup);l.length||(p.closeActive(),i.mask&&(maskstatus=p.mask()),o=t("#"+i.mask),t("body").append(e),i.noscroll===!0&&(s=p.noscroll()),l=t("#"+i.popup),l.hide().attr("popup-status","show").stop(!0,!0).fadeIn(300),i.width&&l.css("width",i.width+"px"),i.height&&l.css("height",i.height+"px"),i.zindex?l.css({zIndex:Number(i.zindex)+10}):(n=o.css("z-index"),l.css({zIndex:Number(n)+10})),l.find(".close").bind("click",function(){p.close(t(this),s)}),p.position(i.popup,i.position),i.fn&&i.fn(p),i.timer&&p.timer(i.timer,i.output),i.esc===!0&&p.esc(l))}})}t(window).resize(function(){p.position(i.popup,i.position)})}}(jQuery);